{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block content %}
<section class="profile-container">
    <header class="profile-header">
        <div>
            <h1 class="profile-title">My Profile</h1>
            <p class="profile-subtitle">View and manage your account information.</p>
        </div>
        <a href="{% url 'user:user_home' %}" class="ui-btn ui-btn--secondary">Back to Home</a>
    </header>

    <div class="profile-grid">
        <article class="profile-card ui-card profile-main-card">
            <div class="profile-card-header">
                <h2 class="profile-card-title">
                    <i class="bi bi-person-circle"></i>
                    Personal Information
                </h2>
            </div>
            <div class="profile-card-body">
                <form method="POST"
                      enctype="multipart/form-data"
                      class="ui-form js-validate"
                      data-disable-submit="true"
                      novalidate>
                    {% csrf_token %}

                    <div class="form-error-summary" hidden role="alert" aria-live="assertive"></div>

                    <div class="profile-info-section">
                        <div class="profile-image-container">
                            <div class="profile-image">
                                {% if profile.profile_image %}
                                    <img src="{{ profile.profile_image.url }}" alt="Current profile photo">
                                {% else %}
                                    {{ user.username|slice:":1"|upper }}
                                {% endif %}
                            </div>
                        </div>

                        <div class="profile-details">
                            <h3 class="profile-name">
                                {% if user.first_name or user.last_name %}
                                    {{ user.first_name }} {{ user.last_name }}
                                {% else %}
                                    {{ user.username }}
                                {% endif %}
                            </h3>

                            <div class="profile-role">
                                <i class="bi bi-shield-check"></i>
                                Pet Owner Account
                            </div>

                            <ul class="info-list">
                                <li class="info-item">
                                    <div class="info-icon"><i class="bi bi-person-badge"></i></div>
                                    <div class="info-content">
                                        <div class="info-label">Username</div>
                                        <div class="info-value">{{ user.username }}</div>
                                    </div>
                                </li>
                                <li class="info-item">
                                    <div class="info-icon"><i class="bi bi-geo-alt"></i></div>
                                    <div class="info-content">
                                        <div class="info-label">Current Address</div>
                                        <div class="info-value">{{ profile.address|default:"No address provided" }}</div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <hr class="ui-divider">

                    <div class="ui-field">
                        <label for="profile-image" class="ui-label">Change Profile Photo (Optional)</label>
                        <input type="file"
                               id="profile-image"
                               name="profile_image"
                               class="ui-input"
                               accept="image/*">
                        <p class="ui-hint">Upload a clear square image for best results.</p>
                    </div>

                    <div class="ui-form__grid ui-form__grid--2">
                        <div class="ui-field">
                            <label for="profile-first-name" class="ui-label">First Name</label>
                            <input id="profile-first-name"
                                   type="text"
                                   name="first_name"
                                   class="ui-input"
                                   value="{{ user.first_name }}"
                                   autocomplete="given-name">
                        </div>

                        <div class="ui-field">
                            <label for="profile-last-name" class="ui-label">Last Name</label>
                            <input id="profile-last-name"
                                   type="text"
                                   name="last_name"
                                   class="ui-input"
                                   value="{{ user.last_name }}"
                                   autocomplete="family-name">
                        </div>
                    </div>

                    <div class="ui-form__grid ui-form__grid--2">
                        <div class="ui-field">
                            <label for="profile-middle-initial" class="ui-label">Middle Initial (Optional)</label>
                            <input id="profile-middle-initial"
                                   type="text"
                                   name="middle_initial"
                                   maxlength="1"
                                   class="ui-input"
                                   value="{{ profile.middle_initial }}">
                        </div>

                        <div class="ui-field">
                            <label for="profile-age" class="ui-label">Age</label>
                            <input id="profile-age"
                                   type="number"
                                   name="age"
                                   class="ui-input"
                                   min="1"
                                   max="120"
                                   inputmode="numeric"
                                   value="{{ profile.age }}">
                        </div>
                    </div>

                    <div class="ui-field">
                        <label for="profile-address" class="ui-label">Address</label>
                        <textarea id="profile-address"
                                  name="address"
                                  class="ui-textarea"
                                  rows="3"
                                  autocomplete="street-address">{{ profile.address }}</textarea>
                    </div>

                    <div class="action-buttons">
                        <button type="submit"
                                class="ui-btn ui-btn--primary"
                                data-loading-text="Saving changes...">
                            <i class="bi bi-check2-circle"></i>
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </article>

        <aside class="profile-card ui-card profile-side-card">
            <div class="profile-card-header">
                <h2 class="profile-card-title">
                    <i class="bi bi-shield-lock"></i>
                    Account Information
                </h2>
            </div>
            <div class="profile-card-body">
                <ul class="info-list">
                    <li class="info-item">
                        <div class="info-icon"><i class="bi bi-person-vcard"></i></div>
                        <div class="info-content">
                            <div class="info-label">Username</div>
                            <div class="info-value">{{ user.username }}</div>
                        </div>
                    </li>
                    <li class="info-item">
                        <div class="info-icon"><i class="bi bi-calendar-event"></i></div>
                        <div class="info-content">
                            <div class="info-label">Date Joined</div>
                            <div class="info-value">{{ user.date_joined|date:"F d, Y" }}</div>
                        </div>
                    </li>
                    <li class="info-item">
                        <div class="info-icon"><i class="bi bi-clock-history"></i></div>
                        <div class="info-content">
                            <div class="info-label">Last Login</div>
                            <div class="info-value">{{ user.last_login|date:"F d, Y g:i A"|default:"Never logged in" }}</div>
                        </div>
                    </li>
                    <li class="info-item">
                        <div class="info-icon"><i class="bi bi-patch-check"></i></div>
                        <div class="info-content">
                            <div class="info-label">Account Status</div>
                            <div class="info-value">
                                {% if user.is_active %}
                                    <span class="status-active">Active</span>
                                {% else %}
                                    <span class="status-inactive">Inactive</span>
                                {% endif %}
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </aside>
    </div>
</section>
{% endblock %}
