{% extends 'admin_base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/post_list.css' %}">

<div class="d-flex justify-content-between align-items-center mb-3">
    <a href="{% url 'dogadoption_admin:create_post' %}" 
       class="btn btn-primary btn-lg create-post-btn">
        <i class="fas fa-plus-circle me-2"></i> Create Post
    </a>
    <div class="dropdown">
        <button class="btn btn-dark dropdown-toggle" type="button" data-bs-toggle="dropdown">
            {% if current_filter == "ready" %}
                ğŸ•’ Ready for Adoption / Claim
            {% elif current_filter == "reunited" %}
                ğŸ§¾ Reunited (Claimed)
            {% elif current_filter == "adopted" %}
                ğŸ  Adopted
            {% else %}
                ğŸ“‹ All Posts
            {% endif %}
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="?status=all">ğŸ“‹ All Posts</a></li>
            <li><a class="dropdown-item" href="?status=ready">ğŸ•’ Ready for Adoption / Claim</a></li>
            <li><a class="dropdown-item" href="?status=reunited">ğŸ§¾ Reunited (Claimed)</a></li>
            <li><a class="dropdown-item" href="?status=adopted">ğŸ  Adopted</a></li>
        </ul>
    </div>
</div>

{% for item in posts %}
    {% with post=item.post %}
<div class="post-card">

    {% if post.is_open_for_claim_adopt %}
        <div class="alert alert-info mb-2">
            â± Time left:
            {{ item.days_left }}d {{ item.hours_left }}h {{ item.minutes_left }}m
        </div>
    {% endif %}

    <div class="post-user">{{ post.user.username }}</div>
    <p class="post-caption">{{ post.caption }}</p>

    <div class="post-meta">
        {% if post.location %}
            ğŸ“ {{ post.location }} <br>
        {% endif %}
        Status: <b>{{ post.get_status_display }}</b> <br>
        Posted on {{ post.created_at|date:"M d, Y H:i" }}
    </div>

    {% if post.images.exists %}
    <div class="post-images">
        {% for image in post.images.all %}
            <img src="{{ image.image.url }}" alt="Dog image">
        {% endfor %}
    </div>
    {% endif %}

    <div class="post-actions mt-3">
        <a href="{% url 'dogadoption_admin:claim_requests' post.id %}" 
           class="btn btn-warning btn-sm">
            ğŸ§¾ Claim
            {% if post.claim_count > 0 %}
                <span class="badge bg-danger">{{ post.claim_count }}</span>
            {% endif %}
        </a>

        <a href="{% url 'dogadoption_admin:adoption_requests' post.id %}" 
           class="btn btn-success btn-sm">
            ğŸ¾ Adopt
            {% if post.adopt_count > 0 %}
                <span class="badge bg-danger">{{ post.adopt_count }}</span>
            {% endif %}
        </a>
    </div>

</div>
    {% endwith %}
{% empty %}
<p class="text-muted">No dog adoption posts found</p>
{% endfor %}

{% endblock %}
