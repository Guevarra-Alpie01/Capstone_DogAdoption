{% extends 'admin_base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/create_announcement.css' %}">

<section class="ui-page ui-page--narrow">
    <article class="ui-card create-announcement-container">
        <div class="ui-card__header">
            <h1 class="ui-card__title">Create Announcement</h1>
            <p class="ui-card__subtitle">Publish clear updates for the community using color or image-based posts.</p>
        </div>

        <div class="ui-card__body">
            <form method="POST"
                  action="{% url 'dogadoption_admin:announcement_create' %}"
                  enctype="multipart/form-data"
                  class="announcement-form ui-form js-validate"
                  data-disable-submit="true"
                  novalidate>
                {% csrf_token %}

                <div class="form-error-summary" hidden role="alert" aria-live="assertive"></div>

                <div class="ui-field">
                    <label for="postType" class="ui-label">Post Type</label>
                    <select name="post_type" class="ui-select" required id="postType">
                        <option value="COLOR">Color Post</option>
                        <option value="IMAGE_BG">Image Background</option>
                        <option value="PHOTO">Photo Post</option>
                    </select>
                </div>

                <div class="ui-field">
                    <label for="announcement-content" class="ui-label">Announcement Text</label>
                    <textarea id="announcement-content"
                              name="content"
                              class="ui-textarea"
                              rows="5"
                              placeholder="Write your announcement here..."
                              required></textarea>
                </div>

                <div id="colorField" class="ui-field toggle-field">
                    <label for="background-color" class="ui-label">Background Color</label>
                    <input type="color" id="background-color" name="background_color" value="#186c5e" class="color-input">
                </div>

                <div id="imageField" class="ui-field toggle-field" style="display:none;">
                    <label for="background-image" class="ui-label">Upload Background / Photo</label>
                    <input type="file" id="background-image" name="background_image" class="ui-input" accept="image/*">
                </div>

                <details class="advanced-panel">
                    <summary>Advanced: Activity Schedule JSON (Optional)</summary>
                    <div class="ui-field mt-3">
                        <label for="schedule-data" class="ui-label">Schedule Data</label>
                        <textarea id="schedule-data"
                                  name="schedule_data"
                                  class="ui-textarea"
                                  rows="5"
                                  placeholder='[{"time": "9:00 AM", "task": "Morning Walk"}]'></textarea>
                        <p class="ui-hint">Use valid JSON array format if you need timeline blocks.</p>
                    </div>
                </details>

                <button type="submit"
                        class="ui-btn ui-btn--primary"
                        id="submitBtn"
                        data-loading-text="Posting...">
                    Post Announcement
                </button>
            </form>
        </div>
    </article>
</section>

<script>
(function () {
    const postType = document.getElementById('postType');
    const colorField = document.getElementById('colorField');
    const imageField = document.getElementById('imageField');

    function toggleFields() {
        const isColor = postType.value === 'COLOR';
        colorField.style.display = isColor ? 'grid' : 'none';
        imageField.style.display = isColor ? 'none' : 'grid';
    }

    postType.addEventListener('change', toggleFields);
    toggleFields();
})();
</script>
{% endblock %}

