{% extends 'admin_base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/claim_adopt_request.css' %}">

<div class="request-header">
    <span class="close-btn" onclick="window.location.href='{% url "dogadoption_admin:post_list" %}'" aria-label="Back to posts">x</span>
    <h1 class="request-title">Adoption Requests: "{{ post.caption }}"</h1>
</div>

{% if requests_meta %}
    {% for item in requests_meta %}
    {% with req=item.req profile=item.profile face_imgs=item.face_images %}
    <div class="request-card">

        <div class="user-profile-block">
            {% if profile.profile_image %}
            <img src="{{ profile.profile_image.url }}" class="profile-img" alt="Profile image">
            {% endif %}
            <div class="user-details">
                <div><strong>{{ req.user.first_name }} {{ req.user.last_name }} {{ profile.middle_initial }}</strong></div>
                <div class="text-muted">{{ profile.address }}</div>
            </div>
            <a href="{% url 'dogadoption_admin:view_faceauth' req.user.id %}" class="ui-btn ui-btn--secondary view-face-btn">View Face Auth</a>
        </div>

        <div class="request-top">
            <div><strong>Requested on:</strong> {{ req.created_at|date:"M d, Y H:i" }}</div>
        </div>

        <p class="request-status">
            <strong>Status:</strong>
            {% if req.status == 'pending' %}
                <span class="text-warning">Pending</span>
            {% elif req.status == 'accepted' %}
                <span class="text-success">Accepted</span>
            {% else %}
                <span class="text-danger">Rejected</span>
            {% endif %}
        </p>

        {% if req.explanation %}
        <p class="request-explanation"><strong>Explanation:</strong> {{ req.explanation }}</p>
        {% endif %}

        {% if req.images.exists %}
        <div class="request-images">
            {% for img in req.images.all %}
            <img src="{{ img.image.url }}" alt="Submitted image">
            {% endfor %}
        </div>
        {% endif %}

        {% if req.status == 'pending' %}
        <div class="request-actions">
            <a href="{% url 'dogadoption_admin:update_request' req.id 'accept' %}" class="ui-btn ui-btn--success accept-btn">Accept</a>
            <a href="{% url 'dogadoption_admin:update_request' req.id 'reject' %}" class="ui-btn ui-btn--danger reject-btn">Reject</a>
        </div>
        {% endif %}

    </div>
    {% endwith %}
    {% endfor %}
{% else %}
<p class="no-requests">No adoption requests submitted for this post yet.</p>
{% endif %}
{% endblock %}

