{% extends 'admin_base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/registration.css' %}">
{% endblock extra_css %}

{% block content %}
{% include 'admin_registration/registration_navigation.html' %}

<div class="content-body">
    <form method="get" action="{% url 'dogadoption_admin:registration_record' %}" autocomplete="off" class="barangay-search-form">
      <label for="barangay-input">Name of Barangay:</label>
      <input type="text" id="barangay-input" name="barangay" value="{{ selected_barangay|default:'' }}" placeholder="Type barangay name..." oninput="showSuggestions(this.value)">
      <div id="suggestions" class="suggestions-box" style="display:none;"></div>
      <button type="submit">Show Records</button>
    </form>

    {% if dogs %}
      <h4>Records for Barangay: <em>{{ selected_barangay|default:"All (Recent 20)" }}</em></h4>
      
      <div class="table-container">
          <table class="records-table">
            <thead>
              <tr>
                <th rowspan="2">No.</th>
                <th rowspan="2">Date</th>
                <th rowspan="2">Name</th>
                <th rowspan="2">Species</th>
                <th rowspan="2">Sex (M/F)</th>
                <th rowspan="2">Age (yrs)</th>
                <th rowspan="2">Neutering (No/C/S)</th>
                <th rowspan="2">Color</th>
                <th colspan="2">Pet Owner</th>
              </tr>
              <tr>
                <th>Name</th>
                <th>Complete Address</th>
              </tr>
            </thead>
            <tbody>
              {% for dog in dogs %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ dog.date_registered|date:"m-d-Y" }}</td>
                <td>{{ dog.name }}</td>
                <td>{{ dog.species }}</td>
                <td>{{ dog.sex }}</td>
                <td>{{ dog.age }}</td>
                <td>{{ dog.neutering_status }}</td>
                <td>{{ dog.color }}</td>
                <td>{{ dog.owner_name }}</td>
                <td>{{ dog.owner_address }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
      </div>
    {% elif selected_barangay %}
      <p>No records found for barangay: <strong>{{ selected_barangay }}</strong>.</p>
    {% endif %}
</div>

<script>
  // Default list of barangays
  const barangays = [
    "Ali-is","Banaybanay","Banga","Boyco","Bugay","Cansumalig","Dawis","Kalamtukan",
    "Kalumboyan","Malabugas","Mandu-ao","Maninihon","Minaba","Nangka","Narra",
    "Pagatban","Poblacion","San Isidro","San Jose","San Miguel","San Roque","Suba",
    "Tabuan","Tayawan","Tinago","Ubos","Villareal","Villasol"
  ];

  const input = document.getElementById('barangay-input');
  const suggestionsBox = document.getElementById('suggestions');

  function showSuggestions(value) {
    const val = value.trim().toLowerCase();
    if (!val) {
      suggestionsBox.style.display = 'none';
      return;
    }

    // Filter barangays that match the input (case-insensitive)
    const matches = barangays.filter(b => b.toLowerCase().includes(val));

    if (matches.length === 0) {
      suggestionsBox.style.display = 'none';
      return;
    }

    // Build suggestion items
    suggestionsBox.innerHTML = matches.map(b => 
      `<div class="suggestion-item" onclick="selectBarangay('${b}')">${b}</div>`
    ).join('');

    suggestionsBox.style.display = 'block';
  }

  function selectBarangay(value) {
    input.value = value;
    suggestionsBox.style.display = 'none';
  }

  // Hide suggestions when clicking outside
  document.addEventListener('click', (e) => {
    if (!suggestionsBox.contains(e.target) && e.target !== input) {
      suggestionsBox.style.display = 'none';
    }
  });
</script>
{% endblock %}